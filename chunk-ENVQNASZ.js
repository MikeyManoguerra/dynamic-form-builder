import{a as G,b as Ve,c as $e,d as ke}from"./chunk-5W56LDU2.js";import"./chunk-3FBBUYQY.js";import{a as _e,b as he,c as be,d as J,e as O,f as ve,h as Se,i as xe,j as ye,k as Ce,l as Fe,m as we,n as L,o as j,p as B,q as Ee,r as qe,s as Me,t as A,u as Ie,v as Te,w as P,x as K}from"./chunk-OTCIFY7T.js";import{e as de,g as D,h as fe,k as ge,l as R}from"./chunk-FVNLDTLF.js";import"./chunk-WXI33M2S.js";import{$b as pe,Ab as le,B as S,Bb as x,Cb as g,Db as _,Eb as se,I as ne,J as oe,Ka as s,L as H,La as h,M as U,O as T,S as y,W as C,X as F,Y as k,Z as Q,Zb as me,_a as b,_b as ue,a as X,ab as m,ac as ce,b as Y,bc as M,eb as o,fb as r,gb as d,hb as w,i as V,ib as E,kb as N,mb as f,n as Z,nb as v,q as $,r as ee,ub as re,vb as u,wb as ae,x as te,xb as W,y as ie,zb as q}from"./chunk-CVXYIMTF.js";var z=n=>({"border-red-500":n}),Ne=(()=>{let a=class a{set question(t){let i=t||P();this.questionForm.patchValue(i),this._question=i}get question(){return this._question}constructor(t){this.formBuilder=t,this.handleSubmit=new T,this.onCancel=new T,this._question=P(),this.questionForm=this.formBuilder.nonNullable.group({label:["",J.required],type:["",J.required],slug:["",Ve()],required:[!1],library:[!1],order:[1]})}ngOnInit(){this.questionForm.patchValue({order:this.questions.length+1})}onSubmit(){try{let{label:t,type:i,required:e,library:p,order:c}=this.questionForm.value,I=P({label:t,type:i,slug:G(this.questionForm.controls,"label"),required:e,order:c?c-1:1});if(!I.slug)throw new Error("Provided or calculated slug missing");if(this.questions.some(({slug:Oe})=>Oe===I.slug))throw new Error("Slug already exists in form");this.handleSubmit.emit({question:I,toLibrary:p||!1})}catch(t){alert(t)}}};a.\u0275fac=function(i){return new(i||a)(h(Me))},a.\u0275cmp=y({type:a,selectors:[["question-form"]],inputs:{questions:"questions",question:"question"},outputs:{handleSubmit:"handleSubmit",onCancel:"onCancel"},standalone:!0,features:[q],decls:42,vars:23,consts:[[3,"formGroup","ngSubmit"],[1,"form-control"],["for","question-label"],["formControlName","label","id","question-label","type","text",1,"shadow","appearance-none","border-2","rounded","w-full","py-2","px-3","text-gray-700","leading-tight","focus:outline-none","focus:shadow-outline",3,"ngClass"],["for","question-slug"],["formControlName","slug","id","question-slug","type","text",1,"shadow","appearance-none","border-2","rounded","w-full","py-2","px-3","text-gray-700","leading-tight","focus:outline-none","focus:shadow-outline",3,"ngClass"],["for","order"],["formControlName","order","id","order","type","number","min","1",1,"shadow","appearance-none","border","rounded","w-full","py-2","px-3","text-gray-700","leading-tight","focus:outline-none","focus:shadow-outline",3,"max","ngClass"],["for","question-type"],[1,"relative"],["formControlName","type","id","question-type",1,"block","appearance-none","w-full","bg-white","border","border-gray-400","hover:border-gray-500","px-4","py-2","pr-8","rounded","shadow","leading-tight","focus:outline-none","focus:shadow-outline",3,"ngClass"],["value",""],["value","text"],["value","text-area"],[1,"pointer-events-none","absolute","inset-y-0","right-0","flex","items-center","px-2","text-gray-700"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20",1,"fill-current","h-4","w-4"],["d","M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"],[1,"form-control","checkbox-control"],["formControlName","required","id","required","type","checkbox"],["for","required"],["formControlName","library","id","library","type","checkbox"],["for","library"],[1,"flex","justify-end","items-center","gap-3","pt-2"],[1,"underline","hover:no-underline",3,"click"],["type","submit",1,"bg-violet-500","hover:bg-violet-700","text-amber-100","font-bold","py-2","px-4","rounded-full","disabled:opacity-50","disabled:pointer-events-none",3,"disabled"]],template:function(i,e){i&1&&(o(0,"form",0),f("ngSubmit",function(){return e.onSubmit()}),o(1,"div",1)(2,"label",2),u(3,"Label"),r(),d(4,"input",3),g(5,"inputError"),r(),o(6,"div",1)(7,"label",4),u(8,"Slug"),r(),d(9,"input",5),g(10,"inputError"),r(),o(11,"div",1)(12,"label",6),u(13,"Order"),r(),d(14,"input",7),g(15,"inputError"),r(),o(16,"div",1)(17,"label",8),u(18,"Type"),r(),o(19,"div",9)(20,"select",10),g(21,"inputError"),d(22,"option",11),o(23,"option",12),u(24,"Text"),r(),o(25,"option",13),u(26,"Text Area"),r()(),o(27,"div",14),k(),o(28,"svg",15),d(29,"path",16),r()()()(),Q(),o(30,"div",17),d(31,"input",18),o(32,"label",19),u(33,"Required"),r()(),o(34,"div",17),d(35,"input",20),o(36,"label",21),u(37,"Add to Question Library"),r()(),o(38,"div",22)(39,"button",23),f("click",function(){return e.onCancel.emit()}),u(40,"Cancel"),r(),d(41,"input",24),r()()),i&2&&(m("formGroup",e.questionForm),s(4),m("ngClass",x(15,z,_(5,7,e.questionForm.controls.label))),s(5),m("ngClass",x(17,z,_(10,9,e.questionForm.controls.slug))),s(5),m("max",e.questions.length+1)("ngClass",x(19,z,_(15,11,e.questionForm.controls.order))),s(6),m("ngClass",x(21,z,_(21,13,e.questionForm.controls.type))),s(21),m("disabled",e.questionForm.invalid))},dependencies:[A,xe,j,B,be,ye,he,L,O,ve,qe,Ee,Fe,we,M,me,Ie],styles:["[_nghost-%COMP%]{display:block;width:100%;max-width:700px;margin-right:auto;margin-left:auto}.form-control[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-top:16px}.checkbox-control[_ngcontent-%COMP%]{flex-direction:row;gap:10px}"]});let n=a;return n})();var Pe=n=>["/forms",n];function Re(n,a){if(n&1&&(w(0),o(1,"a",8),u(2,"Test"),r(),E()),n&2){let l=a.ngIf;s(),m("routerLink",x(1,Pe,l.slug))}}function Ge(n,a){n&1&&(o(0,"span"),u(1,"Edit"),r())}function ze(n,a){n&1&&u(0,"Cancel")}function He(n,a){if(n&1){let l=N();w(0),o(1,"li",12)(2,"div",13)(3,"p"),u(4),r(),o(5,"p",14),u(6),r()(),o(7,"div",2)(8,"button",4),f("click",function(){let e=C(l).$implicit,p=v(3);return F(p.removeQuestion(e))}),u(9,"Delete"),r()()(),E()}if(n&2){let l=a.$implicit;s(4),ae(l.label),s(2),W("(",l.slug,")")}}function Ue(n,a){if(n&1&&(w(0),o(1,"h2",10),u(2,"Questions"),r(),o(3,"ul"),b(4,He,10,2,"ng-container",11),g(5,"ordered"),r(),E()),n&2){let l=a.ngIf;s(4),m("ngForOf",_(5,1,l.questions))}}function We(n,a){if(n&1){let l=N();o(0,"div",15)(1,"button",16),f("click",function(){C(l);let i=v(2);return F(i.newQuestionFlow=!i.newQuestionFlow)}),u(2,"Add a New Question"),r()()}}function Je(n,a){if(n&1&&(o(0,"option",26),u(1),r()),n&2){let l=a.$implicit;m("value",l.slug),s(),W(" ",l.label," ")}}var Ke=()=>[];function Xe(n,a){if(n&1){let l=N();w(0),o(1,"div",17)(2,"div",18)(3,"select",19),d(4,"option",20),b(5,Je,2,2,"option",21),g(6,"async"),r(),o(7,"div",22),k(),o(8,"svg",23),d(9,"path",24),r()()(),Q(),o(10,"button",4),f("click",function(){C(l);let i=v(2);return F(i.injectLibaryQuestion())}),u(11,"Apply from library"),r()(),o(12,"question-form",25),f("handleSubmit",function(i){C(l);let e=v(2);return F(e.handleQuestionSubmit(i))})("onCancel",function(){C(l);let i=v(2);return F(i.newQuestionFlow=!1)}),g(13,"async"),g(14,"async"),r(),E()}if(n&2){let l=v(2),t;s(3),m("formControl",l.librarySelectControl),s(2),m("ngForOf",_(6,4,l.questionLibrary$)),s(7),m("question",_(13,6,l.currentQuestion$))("questions",((t=_(14,8,l.form$))==null?null:t.questions)||le(10,Ke))}}function Ye(n,a){if(n&1&&(w(0),b(1,Ue,6,3,"ng-container",3),g(2,"async"),b(3,We,3,0,"div",9)(4,Xe,15,11,"ng-container",3),E()),n&2){let l=v();s(),m("ngIf",_(2,3,l.form$)),s(2),m("ngIf",!l.newQuestionFlow),s(),m("ngIf",l.newQuestionFlow)}}var De=(()=>{let a=class a{constructor(t,i,e){this.formsStateService=t,this.toast=i,this.router=e,this.fetchForm=new T,this.metadataFormDisabled=!0,this.newQuestionFlow=!1,this.currentQuestion$=new V,this.librarySelectControl=new Se("")}ngOnInit(){this.questionLibrary$=this.formsStateService.questions$}toggleMetadataFormDisabled(){this.metadataFormDisabled=!this.metadataFormDisabled,this.metadataFormDisabled&&this.fetchForm.emit()}injectLibaryQuestion(){this.librarySelectControl.value&&this.formsStateService.getQuestion(this.librarySelectControl.value).pipe(U(this.form$),S(1)).subscribe(([t,i])=>{this.currentQuestion$.next(Y(X({},t),{order:i.questions.length+1}))})}editQuestion(t){}removeQuestion({slug:t}){confirm("Are you sure you want to remove this question?")&&this.form$.pipe($(e=>(e.questions=K(e.questions.filter(p=>t!==p.slug)),e)),S(1)).subscribe(e=>{this.formsStateService.updateForm(e.slug,e)})}handleMetaDataSubmit({form:t,originalSlug:i}){let e=G(t,"title"),p=t.title.value;this.formsStateService.slugInUse(e,{ignore:i}).pipe(S(1),U(this.form$),H(([c])=>c&&this.toast.notify("Slug already in use!")),te(([c])=>!c),$(([c,I])=>I),H(({questions:c})=>{this.formsStateService.updateForm(i,{slug:e,title:p,questions:c}),this.metadataFormDisabled=!0,this.router.navigate(["/forms",e,"edit"])})).subscribe()}handleQuestionSubmit({question:t,toLibrary:i}){i&&this.formsStateService.addQuestion(t),this.librarySelectControl.patchValue(""),this.form$.pipe($(e=>{let p=e.questions.filter(({slug:c})=>c!==t.slug);return e.questions=K(p,t),e}),S(1)).subscribe(e=>{this.formsStateService.updateForm(e.slug,e),this.newQuestionFlow=!1})}};a.\u0275fac=function(i){return new(i||a)(h(R),h(ke),h(D))},a.\u0275cmp=y({type:a,selectors:[["edit-form"]],inputs:{form$:"form$"},outputs:{fetchForm:"fetchForm"},standalone:!0,features:[q],decls:14,vars:9,consts:[[1,"flex","justify-between","items-center"],[1,"text-2xl","font-bold"],[1,"flex","gap-2"],[4,"ngIf"],[1,"underline","hover:no-underline",3,"click"],[4,"ngIf","ngIfElse"],["cancelText",""],[3,"isNew","disabled","form$","handleSubmit"],[1,"underline","hover:no-underline",3,"routerLink"],["class","flex justify-end pt-3",4,"ngIf"],[1,"text-xl","font-bold"],[4,"ngFor","ngForOf"],[1,"flex","gap-2","flex-wrap","justify-between","border","rounded","border-amber-100","p-4","mt-3"],[1,"flex","gap-2","items-center"],[1,"text-sm"],[1,"flex","justify-end","pt-3"],[1,"bg-violet-500","hover:bg-violet-700","text-amber-100","font-bold","py-2","px-4","rounded-full","disabled:opacity-50","disabled:pointer-events-none",3,"click"],[1,"flex","gap-4","items-center","py-3"],[1,"relative"],["id","",1,"block","appearance-none","w-full","bg-white","border","border-gray-400","hover:border-gray-500","px-4","py-2","pr-8","rounded","shadow","leading-tight","focus:outline-none","focus:shadow-outline",3,"formControl"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"pointer-events-none","absolute","inset-y-0","right-0","flex","items-center","px-2","text-gray-700"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20",1,"fill-current","h-4","w-4"],["d","M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"],[3,"question","questions","handleSubmit","onCancel"],[3,"value"]],template:function(i,e){if(i&1&&(o(0,"div",0)(1,"h2",1),u(2,"Form Metadata"),r(),o(3,"div",2),b(4,Re,3,3,"ng-container",3),g(5,"async"),o(6,"span"),u(7,"|"),r(),o(8,"button",4),f("click",function(){return e.toggleMetadataFormDisabled()}),b(9,Ge,2,0,"span",5)(10,ze,1,0,"ng-template",null,6,se),r()()(),o(12,"form-metadata-form",7),f("handleSubmit",function(c){return e.handleMetaDataSubmit(c)}),r(),b(13,Ye,5,5,"ng-container",3)),i&2){let p=re(11);s(4),m("ngIf",_(5,7,e.form$)),s(5),m("ngIf",e.metadataFormDisabled)("ngIfElse",p),s(3),m("isNew",!1)("disabled",e.metadataFormDisabled)("form$",e.form$),s(),m("ngIf",e.metadataFormDisabled)}},dependencies:[A,j,B,L,O,Ce,M,ue,pe,ce,$e,ge,fe,Ne,Te],styles:["[_nghost-%COMP%]{display:block;width:100%;max-width:700px;margin-right:auto;margin-left:auto}.metadata-toggle[_ngcontent-%COMP%]{margin-top:16px}"]});let n=a;return n})();var It=(()=>{let a=class a{constructor(t,i,e){this.formsStateService=t,this.route=i,this.router=e,this.fetchForm$=new V}ngOnInit(){this.form$=ee([this.route.params,this.fetchForm$.pipe(ne(null))]).pipe(oe(([{slug:t}])=>this.formsStateService.getForm(t).pipe(S(1))),ie(t=>(console.log("i am erroring"),this.router.navigate(["/"]),Z(()=>new Error(t)))))}};a.\u0275fac=function(i){return new(i||a)(h(R),h(de),h(D))},a.\u0275cmp=y({type:a,selectors:[["edit-form-page"]],standalone:!0,features:[q],decls:2,vars:1,consts:[[3,"form$","fetchForm"]],template:function(i,e){i&1&&(o(0,"default-layout")(1,"edit-form",0),f("fetchForm",function(){return e.fetchForm$.next()}),r()()),i&2&&(s(),m("form$",e.form$))},dependencies:[M,_e,De],encapsulation:2});let n=a;return n})();export{It as EditFormPageComponent};
